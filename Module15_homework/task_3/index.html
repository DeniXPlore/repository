<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <input class="enter-message"  type="text">
    <button class="send-message">отправить сообщение</button>
    <button class="get-location">узнать геолокацию</button>
    <div class="chat-window"></div>
    <a id="map-link" target="_blank"></a>
    <script>
        const url = "wss://echo-ws-service.herokuapp.com"
        const enterMessage = document.querySelector('.enter-message')
        const sendMessage = document.querySelector('.send-message')
        const getLocation = document.querySelector('.get-location')
        const chat = document.querySelector('.chat-window')
        const mapLink = document.querySelector('#map-link')

        let websocket;

        function writeToScreen(message){
            let pre = document.createElement('p');
            pre.innerHTML = message;
            chat.appendChild(pre)
        }

        sendMessage.addEventListener('click', ()=>{          
            websocket = new WebSocket(url)                        
            const message = enterMessage.value; 
            websocket.send = function (evt){
                writeToScreen(message)}          
            writeToScreen('Sent:' + message);           
            websocket.send(message);                        
            enterMessage.value = '';
        })
        const successGeo = (position) =>{
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude; 
            
            mapLink.href = 'https://www.openstreetmap.org/#map=6/${latitude}/${longitude}';
            mapLink.textContent = "Ссылка на карту";
        }
        getLocation.addEventListener('click', ()=>{
            if(!navigator.geolocation){
                chat.textContent = 'Геолокация не поддерживается'
            } else{
                chat.textContent = 'Определение местоположения...'
                navigator.geolocation.getCurrentPosition(successGeo);                
          }
        }
        )
    </script>
</body>
</html>